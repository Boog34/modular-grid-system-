<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Modular Grid Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: system-ui, -apple-system, Helvetica, Arial, sans-serif;
    margin: 0;
    padding: 2rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    background: #ffffff;
    color: #111;
    line-height: 1.6;
  }

  h1, h2 { margin-top: 0; }

  .field-group {
    margin-bottom: 1.2rem;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.3rem;
  }

  input {
    width: 100%;
    max-width: 240px;
    padding: 0.55rem 0.75rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }

  button {
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background: #222;
    color: #fff;
    margin-top: 0.5rem;
  }

  .output {
    margin-top: 2rem;
    padding: 1.5rem;
    border-radius: 6px;
    background: #f7f7f7;
    border: 1px solid #ddd;
  }

  .mode-switch {
    margin-bottom: 1.5rem;
  }

  @media (max-width: 600px) {
    body { padding: 1.25rem 1.75rem 1.25rem 1.5rem; }
    .output { padding: 1.25rem; }
    input { max-width: 100%; }
  }
</style>

</head>
<body>

<h1>Modular Grid Calculator</h1>
<p>Select a mode to calculate the structure of your grid.</p>

<!-- MODE SELECTOR -->
<div class="mode-switch">
  <label><input type="radio" name="mode" value="baseline" checked> Baseline Grid Mode</label>
  <label><input type="radio" name="mode" value="square"> Square Module Mode</label>
</div>

<!-- BASELINE GRID MODE -->
<div id="baselineSection">
  <h2>Baseline Grid Inputs</h2>

  <div class="field-group">
    <label>Page height (mm)</label>
    <input type="number" id="pageHeightMM" value="297" step="0.01">
  </div>

  <div class="field-group">
    <label>Baseline increment (pt)</label>
    <input type="number" id="baseline" value="12" step="0.01">
  </div>

  <div class="field-group">
    <label>Number of modules (rows)</label>
    <input type="number" id="rows" value="6" step="1">
  </div>

  <div class="field-group">
    <label>Gutter height (pt)</label>
    <input type="number" id="gutter" value="12" step="0.01">
  </div>
</div>

<!-- SQUARE MODULE MODE -->
<div id="squareSection" style="display:none;">
  <h2>Square Modules Inputs</h2>

  <div class="field-group">
    <label>Page width (mm)</label>
    <input type="number" id="pageWidthMM" value="210" step="0.01">
  </div>

  <div class="field-group">
    <label>Page height (mm)</label>
    <input type="number" id="pageHeightSquareMM" value="297" step="0.01">
  </div>

  <div class="field-group">
    <label>Margin (mm)</label>
    <input type="number" id="marginMM" value="10" step="0.01">
  </div>

  <div class="field-group">
    <label>Columns (C)</label>
    <input type="number" id="columns" value="6" step="1">
  </div>

  <div class="field-group">
    <label>Rows (R)</label>
    <input type="number" id="rowsSquare" value="8" step="1">
  </div>

  <div class="field-group">
    <label>Gutter (pt)</label>
    <input type="number" id="gutterSquare" value="12" step="0.01">
  </div>
</div>

<button onclick="calculate()">Calculate</button>

<div id="output" class="output">
  Enter values and click <strong>Calculate</strong>.
</div>

<script>
// Toggle mode UI
document.querySelectorAll("input[name='mode']").forEach(radio => {
  radio.addEventListener("change", () => {
    const mode = document.querySelector("input[name='mode']:checked").value;

    document.getElementById("baselineSection").style.display =
      mode === "baseline" ? "block" : "none";

    document.getElementById("squareSection").style.display =
      mode === "square" ? "block" : "none";

    document.getElementById("output").innerHTML =
      "Enter values and click <strong>Calculate</strong>.";
  });
});

function calculate() {
  const mode = document.querySelector("input[name='mode']:checked").value;

  const mmToPt = 72 / 25.4;
  const ptToMm = 25.4 / 72;
  const gutterPtToMm = 0.352778;

  /* ------------------------------ BASELINE MODE ------------------------------- */
  if (mode === "baseline") {
    const H_mm = parseFloat(document.getElementById("pageHeightMM").value);
    const B = parseFloat(document.getElementById("baseline").value);
    const N = parseInt(document.getElementById("rows").value);
    const G = parseFloat(document.getElementById("gutter").value);

    const H = H_mm * mmToPt;

    const k = Math.floor((H - (N - 1) * G) / (N * B));
    const moduleHeight = k * B;
    const liveArea = (N * moduleHeight) + ((N - 1) * G);
    const leftover = H - liveArea;

    const outputHTML = `
      <h2>Baseline Grid Results</h2>
      <p><strong>Baselines per module (k):</strong> ${k}</p>
      <p><strong>Module height:</strong> ${moduleHeight.toFixed(2)} pt (${(moduleHeight * ptToMm).toFixed(2)} mm)</p>
      <p><strong>Live area:</strong> ${liveArea.toFixed(2)} pt (${(liveArea * ptToMm).toFixed(2)} mm)</p>
      <p><strong>Leftover:</strong> ${leftover.toFixed(2)} pt (${(leftover * ptToMm).toFixed(2)} mm)</p>
    `;
    document.getElementById("output").innerHTML = outputHTML;
  }

  /* ------------------------------ SQUARE MODE ------------------------------- */
  if (mode === "square") {
    const W_mm = parseFloat(document.getElementById("pageWidthMM").value);
    const H_mm = parseFloat(document.getElementById("pageHeightSquareMM").value);
    const M_mm = parseFloat(document.getElementById("marginMM").value);
    const C = parseInt(document.getElementById("columns").value);
    const R = parseInt(document.getElementById("rowsSquare").value);
    const G_pt = parseFloat(document.getElementById("gutterSquare").value);

    const gutterMM = G_pt * gutterPtToMm;

    const W_live = W_mm - 2 * M_mm;
    const H_live = H_mm - 2 * M_mm;

    const moduleWidthMM = (W_live - (C - 1) * gutterMM) / C;
    const moduleHeightMM = moduleWidthMM;

    const requiredHeightMM =
      (R * moduleHeightMM) + ((R - 1) * gutterMM);

    const fits = requiredHeightMM <= H_live
      ? "✔ Fits inside margins"
      : "✖ Does NOT fit (grid too tall for live area)";

    const outputHTML = `
      <h2>Square Modules Results</h2>
      <p><strong>Live area:</strong> ${W_live.toFixed(2)} × ${H_live.toFixed(2)} mm</p>
      <p><strong>Module width:</strong> ${moduleWidthMM.toFixed(2)} mm (${(moduleWidthMM * mmToPt).toFixed(2)} pt)</p>
      <p><strong>Module height:</strong> ${moduleHeightMM.toFixed(2)} mm (${(moduleHeightMM * mmToPt).toFixed(2)} pt)</p>
      <p><strong>Required height for ${R} rows:</strong> ${requiredHeightMM.toFixed(2)} mm</p>
      <p><strong>Status:</strong> ${fits}</p>
    `;

    document.getElementById("output").innerHTML = outputHTML;
  }
}
</script>

</body>
</html>
